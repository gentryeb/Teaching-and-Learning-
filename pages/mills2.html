<!DOCTYPE html>
<html>
<head>
	<title>Learning Module Faulkner</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
	<link rel="stylesheet" href="../css/family.css">
	<link rel="stylesheet" href="../css/learning_module.css">


	<style>
	</style>
</head>
<body>
	<!--Modal for looping instructional video-->
	<div id="myModal" class="video">
		<div class="modal-content">
			<span class="close">&times;</span>
			<video autoplay loop muted>
				<source src="../video/cummulative_characters_quickdemo.mp4" type="video/mp4">
				Your browser does not support the video tag.
			</video>
		</div>
	</div>

	<div class="modal bd-example-modal-lg" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">
						Title of Picture
					</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="modal-image">
						<img src="../images/little_girl.png" class="img-fluid">
					</div>
				</div>
				<div class="modal-footer">
					Footer text with full citation.
				</div>
			</div>
		</div>
	</div>



	<!--This is the header menus no need to touch this.-->
	<div id="page_header">
		<div id="header_logo"><a class="logo" href="http://faulkner.iath.virginia.edu/"><span class="digital">DIGITAL</span> Yoknapatawpha</a> · Teaching &amp; Learning</div>
		<div id="main-menu">
			<ul id="main-menu-links">
				<li>
					<a href="http://faulkner.iath.virginia.edu/family/index-about.php">About</a>
					<ul>
						<li class="first-item"><a href="http://faulkner.iath.virginia.edu/family/credits.php">Credits</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/dedication" target="_blank">Dedication</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/digital-yoknapatawpha-bibliography" target="_blank">Bibliography</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/family/dysocialmedia.php">DY on Social Media</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/digital-yoknapatawpha-articles-presentations" target="_blank">Re-Presenting DY</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/family/videos-2016demos.php">2016 Demos</a></li>
					</ul>
				</li>
				<li class="bullet-link">
					<a href="http://faulkner.iath.virginia.edu/family/index-search.php">Search</a>
					<ul>
						<li class="first-item"><a href="http://faulkner.iath.virginia.edu/family/events/">Events</a></li>
						<li>
							<span class="nav-blank">Characters</span>
							<ul>
								<li class="first-item"><a href="http://faulkner.iath.virginia.edu/family/characters/">By Text</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/family/cumulative_characters/">Cumulative</a></li>
							</ul>
						</li>
						<li>
							<span class="nav-blank">Locations</span>
							<ul>
								<li class="first-item"><a href="http://faulkner.iath.virginia.edu/family/locations/">By Text</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/family/cumulative_locations/">Cumulative</a></li>
							</ul>
						</li>
					</ul>
				</li>
				<li class="bullet-link">
					<a href="http://faulkner.iath.virginia.edu/family/index-visualizations.php">Visualizations</a>
					<ul>
						<li class="first-item">
							<span class="nav-blank">Location-Character</span>
							<ul>
								<li class="first-item"><a href="http://faulkner.iath.virginia.edu/characters-force.html">Force Directed</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/characters-bipart.html">Bipartite</a></li>
							</ul>
						</li>
						<li><a href="http://faulkner.iath.virginia.edu/char-char-force.html">Character-Character</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/characters-graph.html">Character-Event</a></li>
						<li>
							<span class="nav-blank">Heatmaps</span>
							<ul>
								<li class="first-item"><a href="http://faulkner.iath.virginia.edu/family/heatmaps/spatial_heatmaps.php">Spatial</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/family/heatmaps/temporal_heatmaps.php">Temporal</a></li>
							</ul>
						</li>
						<li>
							<span class="nav-blank">Photographs</span>
							<ul>
								<li class="first-item"><a href="http://faulkner.iath.virginia.edu/family/photograph_locations.php">by Location</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/family/photograph_repositories.php">by Repository</a></li>
							</ul>
						</li>
						<li><a href="http://faulkner.iath.virginia.edu/narrativeanalysis.html" target="_blank">Narrative Analysis</a></li>
					</ul>
				</li>
				<li class="bullet-link">
					<a href="http://faulkner.iath.virginia.edu/family/index-commentaries.php">Commentaries</a>
					<ul>
						<li class="first-item"><a href="http://faulkner.iath.virginia.edu/media/resources/DISPLAYS/FaulknerMapsHP.html" target="_blank">Faulkner &amp; Maps</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/YokCemeteries.html">Cemeteries</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/family/">Genealogies</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/racial_demography/">Race &amp; Place</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/family/aa_sources.php">Analyzing <em>Absalom, Absalom!</em></a></li>
					</ul>
				</li>
				<li class="bullet-link">
					<a href="http://faulkner.iath.virginia.edu/family/index-teaching_and_learning.php">Teaching &amp; Learning</a>
					<ul>
						<li class="first-item">
							<span class="nav-blank">Resources by Text</span>
							<ul>
								<li class="first-item"><a href="http://faulkner.iath.virginia.edu/family/resources-re.php">"A Rose for Emily"</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/family/resources-ld.php">As I Lay Dying</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/family/resources-sf.php">The Sound and the Fury</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/family/resources-aa.php">Absalom, Absalom!</a></li>
								<li><a href="http://faulkner.iath.virginia.edu/family/resources-ds.php">"Dry September"</a></li>
							</ul>
						</li>
						<li><a href="http://faulkner.iath.virginia.edu/family/videos-teaching_and_learning.php">Videos</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/pedagogyarticles" target="_blank">Articles</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/tlworksheethomepage" target="_blank">Worksheets</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/swhomepage" target="_blank">Student Work</a></li>
					</ul>
				</li>
				<li class="bullet-link">
					<a href="http://faulkner.iath.virginia.edu/family/index-indexes.php">Indexes</a>
					<ul>
						<li class="first-item"><a href="http://faulkner.iath.virginia.edu/family/cumulative_characters.php">Cumulative Characters</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/family/cumulative_locations.php">Cumulative Locations</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/family/recurring_events.php">Recurring Events</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/indexofmssetc" target="_blank">Manuscripts</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/indexofmagazineillustrations" target="_blank">Illustrations</a></li>
						<li><a href="https://faulkner.drupal.shanti.virginia.edu/content/indexofaudioclips" target="_blank">Audio Clips</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/family/contributors.php">Scholarly Collaborators</a></li>
						<li><a href="http://faulkner.iath.virginia.edu/family/videos-index.php">DY Videos</a></li>
					</ul>
				</li>
			</ul>
		</div>
	</div>

	<!--This is where the header ends-->
	<!--This is the TOC menu. No need to touch this-->
	<div class="container">


		<div class="sidebar">
			<h1 class="content_title">Table of Contents</h1>
			<ul>
				<li><a href="#Preface">Preface</a></li>
				<li><a href="#Activities">Activities</a></li>
				<li><a href="#Final Product">Final Product</a></li>
				<li><a href="#Resources">Resources</a></li>
				<li><a href="#For Teachers">For Teachers</a></li>
				<li><a href="#About">About</a></li>
			</ul>
		</div>
		<!--This is where the TOC ends-->
		<!--This is where all the content for the lesson plan sits-->
		<div class="main">
			<h1 class="content_title" id="Preface">Lesson Plan</h1>

			<h2 class="content_sub_title" id="Preface">Preface</h2>
			<!--Enter the paragraph for Preface here. Put each individual paragaraph between <p></p>-->

			<p>In The Sound and the Fury, Caddy is both <em>the</em> central character and <em>the</em> chapter-less character. In this series of activities (pick and choose or do them all), we will use DY to help us deepen our understanding of Caddy’s world. This is DY at its best: the tools here can help us question what we know about Caddy, how we learn it, and will raise the question: do we really know anything about her? DY can help us think about Caddy in ways we have not before.</p>

			<p>(Tip: You can do the following exercises with any character, and any central female character, such as Minnie from Dry September or Emily from A Rose for Emily.)</p>

			<!--The activities section is probably the most complex because there are a lot of components and not all of them will be there simultaneously-->
			<h2 class="content_sub_title" id="Activities">Activities</h2>



			<div class="activity">

				<!-- Every activity has it's own heading'. If there is only one activity then obviously it is not activity 1.
		Grab the line below to create a new activity heading.-->
				<h3 class="content_sub_title activity-title" id="Activity 1">Activity 1: Who Does Caddy Spend Time With?</h3>


				<!--This is a stub for the "Study Acivity section"-->

				<div class="activity-section">

					<!--This is the section title-->

					<div class="activity-title">
						<i class="bi bi-file-earmark-text"></i>
						Study: The Sound and the Fury
					</div>

				</div>


				<div class="row">
					<div class="col">

						<!--This is where the list on the left hand side is populated-->
						<div class="activity-instructions">
							Instructions
							<div class="activity-text">
								<p>Using the graph extrapolated from DY data, we can see that Caddy is never alone in the novel. This raises the question: who is she with? Who are her friends? Does she have any friends? Also: who else in th novel is never alone? (Hint: Caroline, Mr. Compson, Frony..)</p>
							</div>
						</div>
					</div>

					<!--This is where the fancy quote on the right is created.-->
					<div class="col-4">
						<div class="activity-image">
							<div class="thumbnail-container">
								<img src="../images/placeholder.png" alt="Cummulative Character Video" class="img-fluid">
							</div>
						</div>
					</div>
				</div>
			</div>


			<!--This is where the activity section Study Ends-->
			<!--This is where the activity section Explore begins-->



			<div class="activity">

				<!-- Every activity has it's own heading'. If there is only one activity then obviously it is not activity 1.
		Grab the line below to create a new activity heading.-->
				<h3 class="content_sub_title activity-title" id="Activity 1">Activity 2: Who Does Caddy Spend Time With? (part II)</h3>
				<div class="activity-section">


					<div class="activity-section">
						<div class="activity-title">
							<i class="bi bi-globe"></i>
							Explore: Digital Yoknapatawpha: Character Networks
						</div>

					</div>

					<div class="row">

						<!--Walthrough instructions on the left-->
						<div class="col">
							<div class="activity-instructions">
								Walkthrough
								<ul class="activity-list" type="1">
									<li>
										From the DY Main Menu, choose
										<ul class="activity-list" type="a">
											<li>Visualizations</li>
											<li>character-character</li>
											<li>Force Directed Graph</li>
										</ul>
									</li>
									<li> Select <em>Sound and the Fury</em></li>

								</ul>
							</div>
						</div>
						<div class="col-4">
							<div class="activity-instructions">
								Sound and the Fury Bipartite (actual video will pop up eventually!)
								<div class="thumbnail-container">
									<img src="../images/sf_bipartite.png" alt="Sound and the Fury Bipartite" class="img-fluid">
								</div>
							</div>
						</div>
					</div>



					<div class="row">
						<div class="col">
							<div class="activity-instructions">
								Guided Questions

								<ul class="activity-list-unordered">
									<li>If we assume that Caddy is most likely to be friends with other white, upper-class, females, choose White for Race, Upper Class for Class, and Female for Gender.</li>
									<li>
										<p>What do you see?</p> <p>(Below is the graph that should result)?</p>
										<div class="note">With some doing this could be the actual interactive result from the search.</div>
										<button class="btn btn-default zoom-btn" id="zoom_in_bs">+</button><button class="btn btn-default zoom-btn" id="zoom_out_bs">-</button>
										<div id="graph">
											<svg width="930" height="650" style="cursor: move;" xlink="http://www.w3.org/1999/xlink">
												<style type="text/css">
													.present {
														stroke: rgb(136, 136, 136);
													}

													.link {
														fill: none;
													}
												</style>
												<g transform="translate(-200,77)scale(1)"><path g="M642.5497591886316,448.2780875707677SNaN,NaN 642.5497591886316,448.2780875707677" class="link present" stroke-width="3.6666666666666665" opacity="0.5" style="stroke: rgb(240, 0, 0); opacity: 0.5;" d="M569.745627567985,96.20006715801216S550.1661529063902,257.1322084444183 473.39545893044584,399.92146039814116"></path><path g="M642.5497591886316,448.2780875707677SNaN,NaN 642.5497591886316,448.2780875707677" class="link present" stroke-width="2.4222222222222225" opacity="0.5" style="stroke: rgb(240, 0, 0); opacity: 0.5;" d="M569.745627567985,96.20006715801216S640.3690237972875,137.78465123862364 663.7359899612544,216.33989689676238"></path><path g="M642.5497591886316,448.2780875707677SNaN,NaN 642.5497591886316,448.2780875707677" class="link present" stroke-width="5" opacity="0.5" style="stroke: rgb(240, 0, 0); opacity: 0.5;" d="M663.7359899612544,216.33989689676238S589.3920786599921,329.72380186173206 473.39545893044584,399.92146039814116"></path><path g="M642.5497591886316,448.2780875707677SNaN,NaN 642.5497591886316,448.2780875707677" class="link present" stroke-width="1.8" opacity="0.5" style="stroke: rgb(240, 0, 0); opacity: 0.5;" d="M663.7359899612544,216.33989689676238S678.4332306676752,314.2077411630905 633.8865641735599,402.58035190863075"></path><path g="M642.5497591886316,448.2780875707677SNaN,NaN 642.5497591886316,448.2780875707677" class="link present" stroke-width="1.1777777777777778" opacity="0.5" style="stroke: rgb(240, 0, 0); opacity: 0.5;" d="M663.7359899612544,216.33989689676238S556.8552030705692,306.62353999292503 421.9852282088649,343.83548293992203"></path><path g="M642.5497591886316,448.2780875707677SNaN,NaN 642.5497591886316,448.2780875707677" class="link present" stroke-width="1.2666666666666666" opacity="0.5" style="stroke: rgb(240, 0, 0); opacity: 0.5;" d="M473.39545893044584,399.92146039814116S554.13795996884,371.255022397927 633.8865641735599,402.58035190863075"></path><g class="node" transform="translate(569.745627567985,96.20006715801216)" cx="569.745627567985" cy="96.20006715801216"><path d="M-7.0898154036220635,-7.0898154036220635L7.0898154036220635,-7.0898154036220635 7.0898154036220635,7.0898154036220635 -7.0898154036220635,7.0898154036220635Z" style="fill: rgb(51, 102, 204); stroke-width: 1.5; stroke: white; opacity: 1;"></path></g><g class="node" transform="translate(663.7359899612544,216.33989689676238)" cx="663.7359899612544" cy="216.33989689676238"><path d="M-7.0898154036220635,-7.0898154036220635L7.0898154036220635,-7.0898154036220635 7.0898154036220635,7.0898154036220635 -7.0898154036220635,7.0898154036220635Z" style="fill: rgb(51, 102, 204); stroke-width: 1.5; stroke: white; opacity: 1;"></path></g><g class="node" transform="translate(473.39545893044584,399.92146039814116)" cx="473.39545893044584" cy="399.92146039814116"><path d="M-7.0898154036220635,-7.0898154036220635L7.0898154036220635,-7.0898154036220635 7.0898154036220635,7.0898154036220635 -7.0898154036220635,7.0898154036220635Z" style="fill: rgb(51, 102, 204); stroke-width: 1.5; stroke: white; opacity: 1;"></path></g><g class="node" transform="translate(421.9852282088649,343.83548293992203)" cx="421.9852282088649" cy="343.83548293992203"><path d="M-7.0898154036220635,-7.0898154036220635L7.0898154036220635,-7.0898154036220635 7.0898154036220635,7.0898154036220635 -7.0898154036220635,7.0898154036220635Z" style="fill: rgb(51, 102, 204); stroke-width: 1.5; stroke: white; opacity: 1;"></path></g><g class="node" transform="translate(633.8865641735599,402.58035190863075)" cx="633.8865641735599" cy="402.58035190863075"><path d="M-7.0898154036220635,-7.0898154036220635L7.0898154036220635,-7.0898154036220635 7.0898154036220635,7.0898154036220635 -7.0898154036220635,7.0898154036220635Z" style="fill: rgb(51, 102, 204); stroke-width: 1.5; stroke: white; opacity: 1;"></path></g><text dy=".35em" dx="8" transform="translate(569.745627567985,96.20006715801216)" style="font-size: 10px; font-weight: normal; opacity: 1;"> (Miss) Quentin</text><text dy=".35em" dx="8" transform="translate(663.7359899612544,216.33989689676238)" style="font-size: 10px; font-weight: normal; opacity: 1;"> Caddy Compson</text><text dy=".35em" dx="8" transform="translate(473.39545893044584,399.92146039814116)" style="font-size: 10px; font-weight: normal; opacity: 1;"> Mrs. Caroline Compson</text><text dy=".35em" dx="8" transform="translate(421.9852282088649,343.83548293992203)" style="font-size: 10px; font-weight: normal; opacity: 1;"> Mrs. Bland</text><text dy=".35em" dx="8" transform="translate(633.8865641735599,402.58035190863075)" style="font-size: 10px; font-weight: normal; opacity: 1;"> Damuddy</text></g>
											</svg>
										</div>
										<button class="btn btn-default" id="freeze" style="display: none;" onclick="freezeNodes(true);$('#freeze').hide();$('#unfreeze').show();">Freeze</button>
										<button id="unfreeze" class="btn btn-default" style="" onclick="freezeNodes(false);$('#unfreeze').hide();$('#freeze').show();">UnFreeze</button>

										(Hint: the boldest lines depict the strongest connections)
									</li>
									<li>
										Let’s try that again, this time removing all search parameters except Female. What do you see?
									</li>
									<li>
										<p>And again, removing all search parameters except for:</p>
										<p>Text: The Sound and the Fury</p>
										<p>What do you see?</p>
										<p>(this one is a bit overwhelming, but try to find the Caddy Compson square in the melee and click on it for a more concentrated graph)</p>
									</li>
									<li>Play around with this function for a few minutes, using search parameters of your choice.</li>
									<li>(Hint: what we see is that Caddy’s entire social network is either familial or peripheral. Her strongest connections are to her family, and she has no real friends. What does this tell us about her life?)</li>
								</ul>

							</div>
						</div>
					</div>

					<!--Video on the right-->
					<!--MAKE THIS INTO AN EXPLORE SECTION-->
					<!--This is the title stub-->


				</div>
			</div>


			<div class="activity">

				<!-- Every activity has it's own heading'. If there is only one activity then obviously it is not activity 1.
		Grab the line below to create a new activity heading.-->
				<h3 class="content_sub_title activity-title" id="Activity 1">
					Activity 3: here Does Caddy Go? In Faulkner, Who Gets to Go Where?
				</h3>


				<!--This is a stub for the "Study Acivity section"-->
				<!--This is where the activity section Study Ends-->
				<!--This is where the activity section Explore begins-->
				<div class="activity-section">
					<div class="activity-title">
						<i class="bi bi-globe"></i>
						Explore: Digital Yoknapatawpha: Cumulative Characters
					</div>

				</div>

				<div class="row">

					<!--Walthrough instructions on the left-->
					<div class="col">
						<div class="activity-instructions">
							Walkthrough
							<ol class="activity-list" type="1">
								<li>From the DY banner, choose Search</li>
								<li>Then Events</li>
								<li>Then The Sound and the Fury</li>
								<li>Then your chosen character</li>
								<li>Then Present</li>
								<li>Then Search</li>
								<li>
									Then the Map It button
								</li>
							</ol>
							<ul class="activity-list-unordered">
								<li>As a class, perform the above search and Map It function for Benjy. You will see, as you would expect, that Benjy’s movements in the story are confined and limited. This makes sense: we know that as a character Benjy is limited emotionally and confined physically.</li>
								<li>Now, break the class into four or five groups, and have each group perform one other Search/ Map It task for the following characters: Caddy, Miss Quentin, Caroline, Dilsey, Jason. Have each group report out what their maps showed. (Hint: Jason gets to move all over the place, but the women are very confined in their movements).</li>
							</ul>





						</div>
					</div>

					<!--Video on the right-->
					<div class="col-4">
						<div class="activity-instructions">
							Video Tutorial
							<div class="thumbnail-container">
								<img src="../images/search.png" alt="Cummulative Character Video" class="img-fluid">
							</div>

						</div>
					</div>
				</div>

				<!--This is where the activity section Explore ends-->
				<!--This is where the activity section Respond Begins -->
				<!--This section stub contains the layout-->

			</div>

			<div class="activity">

				<!-- Every activity has it's own heading'. If there is only one activity then obviously it is not activity 1.
	Grab the line below to create a new activity heading.-->
				<h3 class="content_sub_title activity-title" id="Activity 1">
					Activity 4: Where Does Caddy Go After The Sound and the Fury?

				</h3>


				<!--This is a stub for the "Study Acivity section"-->
				<!--This is where the activity section Study Ends-->
				<!--This is where the activity section Explore begins-->
				<div class="activity-section">
					<div class="activity-title">
						<i class="bi bi-globe"></i>
						Explore: Digital Yoknapatawpha: Cumulative Characters
					</div>

				</div>

				<div class="row">

					<!--Walthrough instructions on the left-->
					<div class="col">
						<div class="activity-instructions">
							Walkthrough
							<ol class="activity-list" type="1">
								<li>From the DY banner, choose Search</li>
								<li>Then Characters</li>
								<li>Then Cumulative</li>
								<li>For Name, write Candace Compson</li>
								<li>In the pop-up, choose Locations</li>

							</ol>
							<ul class="activity-list-unordered">
								<li>
									Compare Caddy’s locations in The Sound and the Fury and The Appendix
								</li>
								<li>How do we interpret this?</li>
							</ul>





						</div>
					</div>

					<!--Video on the right-->
					<div class="col-4">
						<div class="activity-instructions">
							Video Tutorial
							<div class="thumbnail-container">
								<img src="../images/search.png" alt="Cummulative Character Video" class="img-fluid">
							</div>

						</div>
					</div>
				</div>
				</div>



				<div class="activity">

					<!-- Every activity has it's own heading'. If there is only one activity then obviously it is not activity 1.
		Grab the line below to create a new activity heading.-->
					<h3 class="content_sub_title activity-title" id="Activity 1">Activity 5: How Do We Learn About Caddy?</h3>


					<!--This is a stub for the "Study Acivity section"-->

					<div class="activity-section">

						<!--This is the section title-->

						<div class="activity-title">
							<i class="bi bi-file-earmark-text"></i>
							Study: The Sound and the Fury
						</div>

					</div>


					<div class="row">
						<div class="col">

							<!--This is where the list on the left hand side is populated-->
							<div class="activity-instructions">
								Instructions
								<div class="activity-text">
									<p>We know that much of The Sound and the Fury swirls around the past, but what is interesting about this graph? What does it tell us?</p>
								</div>
							</div>
						</div>

						<!--This is where the fancy quote on the right is created.-->
						<div class="col-4">
							<div class="activity-image">
								<div class="thumbnail-container">
									<img src="../images/caddy_narrative_status.png" alt="Cummulative Character Video" class="img-fluid">
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<!--This is where the activity section Explore ends-->
				<!--This is where the activity section Respond Begins -->
				<!--This section stub contains the layout-->

	


			<h2 class="content_sub_title" id="Final Product">Final Product</h2>
			<div class="activity-instructions">
			Class Discussion:
			<ul class="activity-list-unordered">
				<li>What are some conclusions you can make about what it is like to live Caddy’s life?</li>
				<li>Is Caddy’s world big or small?</li>
				<li>How does she respond to that reality? Does her world affect the decisions that she makes? </li>
				<li>What decisions does she make?</li>
				<li>What are the “proper tools” that Faulkner uses to tell Caddy’s story? Do they work?</li>
				<li>Does the relative insular world of the Compson family contribute to her brothers’ obsessions with her? How do other characters affect her decisions?</li>
				<li>What is it like to be Caddy?</li>

			</ul>
			
			
			</div>




			<h2 class="content_sub_title" id="Resources">Resources</h2>

			<ul class="activity-list-unordered">
				<li>Force-Directed Character Graph</li>
				<li>Events Maps</li>
				<li>Cumulative Character Search</li>


			</ul>


			<h1 class="content_title" id="For Teachers">For Teachers</h1>

			<p>Pilot Classroom: </p>

			<p>
				Learning Goals:
			<p>


				<ul class="activity-list-unordered">
					<li>Learning Goal 1</li>
					<li>Learning Goal 2</li>
					<li>Learning Goal 3</li>
				</ul>

			<p>Common Core: </p>


			<ul class="activity-list-unordered">
				<li>Common Core 1</li>
				<li>Common Core 2</li>
				<li>Common Core 3</li>
			</ul>

			<p> Student Samples: </p>

			<p> Original Lesson Plan: </p>




			<h1 class="content_title" id="About">About</h1>
			<div class="note"><em>Note: </em> About section that includes all extra information </div>
			<p>Instructor: </p>
			<p>Contact: </p>
			<p>Created: </p>
			<p>Notes: </p>


		</div>





	</div>








	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(document).ready(function () {
			$(".thumbnail-container img").click(function () {
				$("#myModal").show();
			});

			$(".close").click(function () {
				$("#myModal").hide();
			});


			$(".activity-image img").click(function () {
				$("#imageModal").show();
			});

			$(".close").click(function () {
				$("#imageModal").hide();
			});

		});
	</script>
	<script>
		var getUrlParameter = function getUrlParameter(sParam) {
			var sPageURL = decodeURIComponent(window.location.search.substring(1)),
				sURLVariables = sPageURL.split('&'),
				sParameterName,
				i;

			for (i = 0; i < sURLVariables.length; i++) {
				sParameterName = sURLVariables[i].split('=');

				if (sParameterName[0] === sParam) {
					return sParameterName[1] === undefined ? true : sParameterName[1];
				}
			}
		};
		var texts = {};
		$(function () {
			load_texts();

			$('#search').click(function () {
				search();
				$('#freeze').show();
			});

			$('#location').typeahead({
				items: 25,
				source: function (query, result) {
					$.ajax({
						url: "/sinatra/location_names",
						data: 'name=' + query + '&text=' + $('#text').val(),
						dataType: "json",
						success: function (data) {
							var a = $.map(data, function (item) {
								return item;
							}).sort()
							result(a);
						}
					});
				}
			});

			$("#new-search").click(function () {
				$(document).find('input:text, input:password, input:file, select, textarea').val('');
				$('#text').val(getUrlParameter('text'))
				// $("#myform").find('input:radio, input:checkbox').removeAttr('checked').removeAttr('selected');
			});
			$('#all_characters').click(function () {
				$("#results").html('<img src="loading.gif">');
				find_characters('');
			});

			if (getUrlParameter('text') != null) {
				// $('#search-table').hide();
				// $('#all_characters').hide();
				console.log('text=' + getUrlParameter('text'));
				// var data = {};
				// data['text'] = getUrlParameter('text')('text');
				// data['name'] = getUrlParameter('name');
				// $('#search_criteria').html('<h3>Title of text: '+data['text']+'</h3><h3>Name of Character: '+data['name']+'</h3><br>');
				// $('#name').val(data['name']);
				// var str = JSON.stringify(data);
				// $("#results").html('<img src="loading.gif">');
				// find_characters(str);

			}
		});
		function activaTab(tab) {
			$('.nav-tabs a[href="#' + tab + '"]').tab('show');
		};
		function updateModal(title, content) {
			$('#myModalLabel').html(decodeURI(title.replace(/__apos__/g, "'")));
			$('#character').html(decodeURI(content.replace(/__apos__/g, "'")));
			activaTab('character');
		}
		function SortArrayByKeys(inputarray) {
			var arraykeys = [];
			for (var k in inputarray) { arraykeys.push(k); }
			arraykeys.sort();

			var outputarray = {};
			for (var i = 0; i < arraykeys.length; i++) {
				outputarray[arraykeys[i]] = inputarray[arraykeys[i]];
			}
			return outputarray;
		}
		function sortHashTableByKey(hash, key_order, remove_key) {
			var tmp = new Array();
			var end = new Array();
			var f_order = null;
			remove_key = remove_key || false;
			for (var key in hash) {
				if (hash.hasOwnProperty(key)) {
					tmp.push(hash[key][key_order]);
				}
			}
			if (hash && hash[0] && typeof (hash[0][key_order]) === 'number') {
				f_order = function (a, b) { return a - b; };
			}
			// if(f_order != null) {
			tmp.sort();
			// }
			function getHash(hash, value) {
				for (k in hash) {
					if (hash[k] && hash[k][key_order] === value) {
						return { key: k, hash: hash[k] };
					}
				}
			}
			for (var i = 0, l = tmp.length; i < l; i++) {
				tmp[i] = getHash(hash, tmp[i]);
				if (remove_key) {
					delete tmp[i].hash[key_order];
				}
				if (!hash.length) {
					end[tmp[i].key] = tmp[i].hash;
				}
				else {
					end.push(tmp[i].hash);
				}
			}
			return end;
		}

		function load_texts() {
			$.ajax({
				type: 'GET',
				url: '/sinatra/texts',
				// dataType:'json',
				success: function (data) {
					var str = '<select name="text" id="text"><option></option>';
					$.each(data, function (index, value) {
						texts[value['code']] = { 'title': value['title'], 'order': value['DisplayOrder'] };
						if ((getUrlParameter('text') != null) && (getUrlParameter('text') == value['code'])) {
							str += '<option selected value="' + value['code'] + '">' + value['title'] + '</option>';
						} else {
							str += '<option value="' + value['code'] + '">' + value['title'] + '</option>';
						}
						// str += '<option>'+value['title']+'</option>';
					});
					$('#select_text_titles').append(str + '</select>');
					// texts = sortHashTableByKey(texts, 'order');
					if (getUrlParameter('text') != null) {
						$('#search').click();
					}
				}
			});
			return true;
		}

		function load_events(data, location) {
			$.ajax({
				type: 'GET',
				url: '/sinatra/events_from_id?id=' + encodeURIComponent(data),
				// dataType:'json',
				success: function (data) {
					console.log(data);
					$("#events").html(data);
				}
			});
			return true;
		}

		function load_locations(data, location) {
			$.ajax({
				type: 'GET',
				url: '/sinatra/locations_from_id?id=' + encodeURIComponent(data),
				// dataType:'json',
				success: function (data) {
					console.log(data);
					$("#locations").html(data);
				}
			});
			return true;
		}


		//'{"CharacterName":{"$regex":"'+$('#name').val()+'","$options":"i"}}'
		function search() {
			$('.toolTip').remove();
			$('svg').remove();
			$('#unfreeze').hide();
			$('#freeze').show();
			var data = {};
			if ($('#text').val() != '') {
				data['text'] = $('#text').val();
			}
			if ($('#name').val() != '') {
				data['name'] = $('#name').val();
			}
			if (($('#char_mentioned').prop('checked')) || ($('#char_both').prop('checked'))) {
				data['name_mentioned'] = $('#name').val();
				// data['CharactersMentioned'] = {'$regex':$('#char_mentioned').val(),'$options':'i'};
			}
			if ($('#char_present').prop('checked') || ($('#char_both').prop('checked'))) {
				data['name_present'] = $('#name').val();
				// data['CharactersPresent'] = {'$regex':$('#char_present').val(),'$options':'i'};
			}

			if ($('#race').val() != '') {
				data['race'] = $('#race').val();
			}
			if ($('#family').val() != '') {
				data['family'] = $('#family').val();
			}
			if ($('#gender').val() != '') {
				data['gender'] = $('#gender').val();
			}
			if ($('#class').val() != '') {
				data['class'] = $('#class').val();
			}
			if ($('#vitality').val() != '') {
				data['vitality'] = $('#vitality').val();
			}
			if ($('#occupation').val() != '') {
				data['occupation'] = $('#occupation').val();
			}
			if ($('#disability').val() != '') {
				data['disability'] = $('#disability').val();
			}
			if ($('#ethnicity').val() != '') {
				data['ethnicity'] = $('#ethnicity').val();
			}
			if ($('#ontological_status').val() != '') {
				data['ontological_status'] = $('#ontological_status').val();
			}
			if ($('#cause_of_death').val() != '') {
				data['cause_of_death'] = $('#cause_of_death').val();
			}
			if ($('#biography').val() != '') {
				data['biography'] = $('#biography').val();
			}
			if ($('#first_words_present').prop('checked') || ($('#first_words_both').prop('checked'))) {
				data['first_words_present'] = $('#first_words').val();
			}
			if ($('#first_words_mentioned').prop('checked') || ($('#first_words_both').prop('checked'))) {
				data['first_words_mentioned'] = $('#first_words').val();
			}
			// if($('#first_words').val() != '') {
			// 	data['first_words'] = $('#first_words').val();
			// }
			if ($('#location_present').prop('checked') || ($('#location_both').prop('checked'))) {
				data['location_present'] = $('#location').val();
			}
			if ($('#location_mentioned').prop('checked') || ($('#location_both').prop('checked'))) {
				data['location_mentioned'] = $('#location').val();
			}
			if ($('#location').val() != '') {
				data['event_location'] = $('#location').val();
			}
			if ($('#era_present').prop('checked') || ($('#era_both').prop('checked'))) {
				data['era_present'] = $('#era').val();
			}
			if ($('#era_mentioned').prop('checked') || ($('#era_both').prop('checked'))) {
				data['era_mentioned'] = $('#era').val();
			}

			if ($('#specific_job').val() != '') {
				data['specific_job'] = $('#specific_job').val();
			}
			if ($('#origin').val() != '') {
				data['origin'] = $('#origin').val();
			}
			if ($('#narrator').val() != '') {
				data['narrator'] = $('#narrator').val();
			}
			if ($('#event_begin').val() != '') {
				data['event_begin'] = $('#event_begin').val();
			}
			if ($('#event_end').val() != '') {
				data['event_end'] = $('#event_end').val();
			}
			if ($('#publication_begin').val() != '') {
				data['publication_begin'] = $('#publication_begin').val();
			}
			if ($('#publication_end').val() != '') {
				data['publication_end'] = $('#publication_end').val();
			}

			if ($('#change_class').prop('checked')) {
				data['change_class'] = $('#change_class').val();
			}
			if ($('#location_type').val() != '') {
				data['location_type'] = $('#location_type').val();
			}
			if ($('#rank').val() != '') {
				data['rank'] = $('#rank').val();
			}

			// if($('#era').val() != '') {
			// 	data['era'] = $('#era').val();
			// }
			var event_params = '';
			// data['text'] = 'FD';
			$.each(data, function (i, v) {
				if (v != null) {
					event_params += '&' + i + '=' + v;
				}
			})
			// var str = JSON.stringify(data);
			$("#results").html('<img src="loading.gif">');
			find_characters(event_params);
			return false;
		}

		function show_range() {
			$("#date-range").show();
		}
		function hide_range() {
			$("#event_end").val('');
			$("#date-range").hide();
		}

		function show_publication_range() {
			$("#publication-range").show();
		}
		function hide_publication_range() {
			$("#publication_end").val('');
			$("#publication-range").hide();
		}

		function freezeNodes(freeze) {
			d3.selectAll(".node").each(
				function (d) {
					d.fixed = freeze;
				}
			)
		}
		function find_characters(str) {
			var evts = {};
			var w = 1000; //window.innerWidth;
			var h = 650; //window.innerHeight;

			var keyc = true, keys = true, keyt = true, keyr = true, keyx = true, keyd = true, keyl = true, keym = true, keyh = true, key1 = true, key2 = true, key3 = true, key0 = true

			var focus_node = null, highlight_node = null;

			var text_center = false;
			var outline = false;

			var min_score = 0;
			var max_score = 1;

			var color = d3.scale.linear()
				.domain([min_score, (min_score + max_score) / 2, max_score])
				.range(["lime", "yellow", "red"]);

			var highlight_color = "#140000"; //blue";
			var highlight_trans = 0.1;

			var size = d3.scale.pow().exponent(1)
				.domain([1, 100])
				.range([8, 24]);

			var force = d3.layout.force()
				.linkDistance(170)
				.charge(-400)
				.size([w, h]);

			var default_node_color = "#ccc";
			//var default_node_color = "rgb(3,190,100)";
			var default_link_color = "#f00000"; //888";
			var nominal_base_node_size = 8;
			var nominal_text_size = 10;
			var max_text_size = 24;
			var nominal_stroke = 1.5;
			var max_stroke = 4.5;
			var max_base_node_size = 36;
			var min_zoom = 0.1;
			var max_zoom = 7;
			var svg = d3.select("#graph").append("svg");
			var zoom = d3.behavior.zoom().scaleExtent([min_zoom, max_zoom])
			var g = svg.append("g");
			svg.style("cursor", "move");

			function zoomed() {
				g.attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");
			}
			// Simplest possible buttons
			// var b = svg.selectAll(".button")
			//     .data(['zoom_in', 'zoom_out'])
			//     .enter()
			//     .append("rect")
			//     .attr("x", function(d,i){return 10 + 50*i})
			//     .attr({y: 10, width: 40, height: 20, class: "button"})
			//     .attr("id", function(d){return d})
			//     .style("fill", function(d,i){ return i ? "red" : "green"})
			// 	// .text(function(d){ return})

			var barHeight = 20;

			// b.append("text")
			// 			    .attr("x", function(d,i){return 10 + 50*i})
			//       .attr("y", barHeight / 2)
			//       .attr("dy", ".35em")
			//       .text(function(d) { return d; });

			// var bar = svg.selectAll(".button")
			//       .data(['zoom_in', 'zoom_out'])
			//     .enter().append("g")
			//       .attr("transform", function(d, i) { return "translate(0," + 0 * barHeight + ")"; });
			//
			// 				bar.append("rect")
			// 				    .attr("x", function(d,i){return 10 + 50*i})
			// 				    .attr({y: 10, width: 40, height: 20, class: "button"})
			// 				    .attr("id", function(d){return d})
			// 				    .style("fill", "gray") //function(d,i){ return i ? "red" : "green"})
			// 				.on('mouseover', function() { svg.style("cursor","pointer")})
			// 				.on('mouseout', function() {svg.style("cursor","move")});
			// bar.append("text")
			// 				    .attr("x", function(d,i){return 10 + 50*i})
			//       // .attr("x", function(d) { return x(d.value) - 3; })
			//       .attr("y", barHeight / 2)
			// 				.attr("dx", "15")
			//       .attr("dy", "15")
			// 				.attr("class", "zoom-text")
			//       .text(function(d,i) { return i ? '-' : '+'; })
			// 				.on('mouseover', function() { svg.style("cursor","pointer")})
			// 				.on('mouseout', function() {svg.style("cursor","pointer")});

			// d3.selectAll('.button')
			$('.zoom-btn').on('click', function () {
				// d3.event.preventDefault();

				var scale = zoom.scale(),
					extent = zoom.scaleExtent(),
					translate = zoom.translate(),
					x = translate[0], y = translate[1],
					factor = (this.id === 'zoom_in_bs') ? 1.2 : 1 / 1.2,
					target_scale = scale * factor;

				// If we're already at an extent, done
				if (target_scale === extent[0] || target_scale === extent[1]) { return false; }
				// If the factor is too much, scale it down to reach the extent exactly
				var clamped_target_scale = Math.max(extent[0], Math.min(extent[1], target_scale));
				if (clamped_target_scale != target_scale) {
					target_scale = clamped_target_scale;
					factor = target_scale / scale;
				}

				// Center each vector, stretch, then put back
				var center = [650, 250];
				x = (x - center[0]) * factor + center[0];
				y = (y - center[1]) * factor + center[1];

				// Transition to the new view over 350ms
				d3.transition().duration(350).tween("zoom", function () {
					var interpolate_scale = d3.interpolate(scale, target_scale),
						interpolate_trans = d3.interpolate(translate, [x, y]);
					return function (t) {
						zoom.scale(interpolate_scale(t))
							.translate(interpolate_trans(t));
						zoomed();
					};
				});
			});

			d3.json("/sinatra/character_character_force?" + str, function (error, graph) {

				if (graph.nodes.length > 0) {
					$("#results").html('');
					$("html, body").animate({ scrollTop: $(document).height() }, "slow");

				} else {
					$("#results").html('<p>No Results<p>');
				}
				var linkedByIndex = {};
				graph.links.forEach(function (d) {
					linkedByIndex[d.source + "," + d.target] = true;
				});

				function isConnected(a, b) {
					return linkedByIndex[a.index + "," + b.index] || linkedByIndex[b.index + "," + a.index] || a.index == b.index;
				}

				function hasConnections(a) {
					for (var property in linkedByIndex) {
						s = property.split(",");
						if ((s[0] == a.index || s[1] == a.index) && linkedByIndex[property]) return true;
					}
					return false;
				}

				force
					.nodes(graph.nodes)
					.links(graph.links)
					.start();

				var lineFunction = d3.svg.line()
					.x(function (d) { return d.x; })
					.y(function (d) { return d.y; })
					.interpolate("basis");

				function positionLink(d) {
					var offset = 30;

					var midpoint_x = (d.source.x + d.target.x) / 2;
					var midpoint_y = (d.source.y + d.target.y) / 2;

					var dx = (d.target.x - d.source.x);
					var dy = (d.target.y - d.source.y);

					var normalise = Math.sqrt((dx * dx) + (dy * dy));

					var offSetX = midpoint_x + offset * (dy / normalise);
					var offSetY = midpoint_y - offset * (dx / normalise);

					return "M" + d.source.x + "," + d.source.y +
						"S" + offSetX + "," + offSetY +
						" " + d.target.x + "," + d.target.y;
				}

				var link = g.selectAll(".link")
					.data(graph.links)
					// .enter().append("line")
					.enter().append("path")
					.attr("g", function (d) { return positionLink(d) })
					.attr("class", function (d) { return (d.value == 1 ? 'link present' : 'link mentioned') })
					.attr("stroke-width", function (d) { return ((5 - 1) * (d.events / d.max) + 1) }) //nominal_stroke)
					.attr('opacity', 0.5)
					.style('stroke', default_link_color)
				// .style("stroke", function(d) {
				// if (isNumber(d.score) && d.score>=0) return color(d.score);
				// else return default_link_color; })
				$('#saveButton').show();
				var width = 1000, height = 650; //$('svg').attr('height');

				// Set-up the export button
				d3.select('#saveButton').on('click', function () {
					var svgString = getSVGString(svg.node());
					svgString2Image(svgString, 2 * width, 2 * height, 'png', save); // passes Blob and filesize String to the callback

					function save(dataBlob, filesize) {
						saveAs(dataBlob, 'DY-bipartite.png'); // FileSaver.js function
					}
				});

				// Below are the functions that handle actual exporting:
				// getSVGString ( svgNode ) and svgString2Image( svgString, width, height, format, callback )
				function getSVGString(svgNode) {
					svgNode.setAttribute('xlink', 'http://www.w3.org/1999/xlink');
					var cssStyleText = getCSSStyles(svgNode);
					appendCSS(cssStyleText, svgNode);

					var serializer = new XMLSerializer();
					var svgString = serializer.serializeToString(svgNode);
					svgString = svgString.replace(/(\w+)?:?xlink=/g, 'xmlns:xlink='); // Fix root xlink without namespace
					svgString = svgString.replace(/NS\d+:href/g, 'xlink:href'); // Safari NS namespace fix

					return svgString;

					function getCSSStyles(parentElement) {
						var selectorTextArr = [];

						// Add Parent element Id and Classes to the list
						selectorTextArr.push('#' + parentElement.id);
						for (var c = 0; c < parentElement.classList.length; c++)
							if (!contains('.' + parentElement.classList[c], selectorTextArr))
								selectorTextArr.push('.' + parentElement.classList[c]);

						// Add Children element Ids and Classes to the list
						var nodes = parentElement.getElementsByTagName("*");
						for (var i = 0; i < nodes.length; i++) {
							var id = nodes[i].id;
							if (!contains('#' + id, selectorTextArr))
								selectorTextArr.push('#' + id);

							var classes = nodes[i].classList;
							for (var c = 0; c < classes.length; c++)
								if (!contains('.' + classes[c], selectorTextArr))
									selectorTextArr.push('.' + classes[c]);
						}

						// Extract CSS Rules
						var extractedCSSText = "";
						for (var i = 0; i < document.styleSheets.length; i++) {
							var s = document.styleSheets[i];

							try {
								if (!s.cssRules) continue;
							} catch (e) {
								if (e.name !== 'SecurityError') throw e; // for Firefox
								continue;
							}

							var cssRules = s.cssRules;
							for (var r = 0; r < cssRules.length; r++) {
								if (contains(cssRules[r].selectorText, selectorTextArr))
									extractedCSSText += cssRules[r].cssText;
							}
						}


						return extractedCSSText;

						function contains(str, arr) {
							return arr.indexOf(str) === -1 ? false : true;
						}

					}

					function appendCSS(cssText, element) {
						var styleElement = document.createElement("style");
						styleElement.setAttribute("type", "text/css");
						styleElement.innerHTML = cssText;
						var refNode = element.hasChildNodes() ? element.children[0] : null;
						element.insertBefore(styleElement, refNode);
					}
				}


				function svgString2Image(svgString, width, height, format, callback) {
					var format = format ? format : 'png';

					var imgsrc = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString))); // Convert SVG string to data URL

					var canvas = document.createElement("canvas");
					var context = canvas.getContext("2d");

					canvas.width = width;
					canvas.height = height;

					var image = new Image();
					image.onload = function () {
						context.clearRect(0, 0, width, height);
						context.drawImage(image, 0, 0, width, height);

						canvas.toBlob(function (blob) {
							var filesize = Math.round(blob.length / 1024) + ' KB';
							if (callback) callback(blob, filesize);
						});


					};

					image.src = imgsrc;
				}


				var node = g.selectAll(".node")
					.data(graph.nodes)
					.enter().append("g")
					.attr("class", "node")

					.call(force.drag)


				node.on("dblclick.zoom", function (d) {
					d3.event.stopPropagation();
					var dcx = (window.innerWidth / 2 - d.x * zoom.scale());
					var dcy = (window.innerHeight / 2 - d.y * zoom.scale());
					zoom.translate([dcx, dcy]);
					g.attr("transform", "translate(" + dcx + "," + dcy + ")scale(" + zoom.scale() + ")");


				});




				var tocolor = "fill";
				var towhite = "stroke";
				if (outline) {
					tocolor = "stroke"
					towhite = "fill"
				}



				var circle = node.append("path")


					.attr("d", d3.svg.symbol()
						.size(function (d) { return Math.PI * Math.pow(size(d.size) || nominal_base_node_size, 2); })
						.type(function (d) { return d.type; }))

					.style(tocolor, function (d) {
						if (isNumber(d.score) && d.score > 0) return "green";
						else return "#3366cc";
					})
					//.attr("r", function(d) { return size(d.size)||nominal_base_node_size; })
					.style("stroke-width", nominal_stroke)
					.style(towhite, "white");


				var text = g.selectAll(".text")
					.data(graph.nodes)
					.enter().append("text")
					.attr("dy", ".35em")
					.style("font-size", nominal_text_size + "px")

				if (text_center)
					text.text(function (d) { return d.id; })
						.style("text-anchor", "middle");
				else
					text.attr("dx", function (d) { return (size(d.size) || nominal_base_node_size); })
						.text(function (d) { return '\u2002' + d.id; });

				node.on("mouseover", function (d) {
					set_highlight(d);
				})
					.on("mousedown", function (d) {
						d3.event.stopPropagation();
						focus_node = d;
						set_focus(d)
						if (highlight_node === null) set_highlight(d)

					}).on("mouseout", function (d) {
						exit_highlight();

					});

				d3.select(window).on("mouseup",
					function () {
						if (focus_node !== null) {
							focus_node = null;
							if (highlight_trans < 1) {

								circle.style("opacity", 1);
								text.style("opacity", 1);
								link.style("opacity", 0.5);
							}
						}

						if (highlight_node === null) exit_highlight();
					});

				function exit_highlight() {
					highlight_node = null;
					if (focus_node === null) {
						svg.style("cursor", "move");
						if (highlight_color != "white") {
							circle.style(towhite, "white");
							text.style("font-weight", "normal");
							link.style("stroke", function (o) { return (isNumber(o.score) && o.score >= 0) ? color(o.score) : default_link_color });
							link.style("opacity", 0.5);
						}

					}
				}

				function set_focus(d) {
					if (highlight_trans < 1) {
						circle.style("opacity", function (o) {
							return isConnected(d, o) ? 1 : highlight_trans;
						});

						text.style("opacity", function (o) {
							return isConnected(d, o) ? 1 : highlight_trans;
						});

						link.style("opacity", function (o) {
							return o.source.index == d.index || o.target.index == d.index ? 1 : highlight_trans;
						});
					}
				}


				function set_highlight(d) {
					svg.style("cursor", "pointer");
					if (focus_node !== null) d = focus_node;
					highlight_node = d;

					if (highlight_color != "white") {
						circle.style(towhite, function (o) {
							return isConnected(d, o) ? highlight_color : "white";
						});
						text.style("font-weight", function (o) {
							return isConnected(d, o) ? "bold" : "normal";
						});
						link.style("stroke", function (o) {
							return o.source.index == d.index || o.target.index == d.index ? highlight_color : ((isNumber(o.score) && o.score >= 0) ? color(o.score) : default_link_color);

						});
					}
				}


				zoom.on("zoom", function () {

					var stroke = nominal_stroke;
					if (nominal_stroke * zoom.scale() > max_stroke) stroke = max_stroke / zoom.scale();
					// link.style("stroke-width",stroke);
					circle.style("stroke-width", stroke);

					var base_radius = nominal_base_node_size;
					if (nominal_base_node_size * zoom.scale() > max_base_node_size) base_radius = max_base_node_size / zoom.scale();
					circle.attr("d", d3.svg.symbol()
						.size(function (d) { return Math.PI * Math.pow(size(d.size) * base_radius / nominal_base_node_size || base_radius, 2); })
						.type(function (d) { return d.type; }))

					//circle.attr("r", function(d) { return (size(d.size)*base_radius/nominal_base_node_size||base_radius); })
					if (!text_center) text.attr("dx", function (d) { return (size(d.size) * base_radius / nominal_base_node_size || base_radius); });

					var text_size = nominal_text_size;
					if (nominal_text_size * zoom.scale() > max_text_size) text_size = max_text_size / zoom.scale();
					text.style("font-size", text_size + "px");

					g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
				});

				svg.call(zoom).on("wheel.zoom", null);

				resize();
				//window.focus();
				d3.select(window).on("resize", resize).on("keydown", keydown);

				force.on("tick", function () {

					node.attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; });
					text.attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; });

					// link.attr("x1", function(d) { return d.source.x; })
					//   .attr("y1", function(d) { return d.source.y; })
					//   .attr("x2", function(d) { return d.target.x; })
					//   .attr("y2", function(d) { return d.target.y; });

					link.attr("d", positionLink);


					node.attr("cx", function (d) { return d.x; })
						.attr("cy", function (d) { return d.y; });
				});

				function resize() {
					var width = $('#graph').width(); //window.innerWidth,
					var height = $('#graph').height(); //window.innerHeight;
					svg.attr("width", width).attr("height", height);

					force.size([force.size()[0] + (width - w) / zoom.scale(), force.size()[1] + (height - h) / zoom.scale()]).resume();
					w = width;
					h = height;
				}

				function keydown() {
					if (d3.event.keyCode == 32) { force.stop(); }
					else if (d3.event.keyCode >= 48 && d3.event.keyCode <= 90 && !d3.event.ctrlKey && !d3.event.altKey && !d3.event.metaKey) {
						switch (String.fromCharCode(d3.event.keyCode)) {
							case "C": keyc = !keyc; break;
							case "S": keys = !keys; break;
							case "T": keyt = !keyt; break;
							case "R": keyr = !keyr; break;
							case "X": keyx = !keyx; break;
							case "D": keyd = !keyd; break;
							case "L": keyl = !keyl; break;
							case "M": keym = !keym; break;
							case "H": keyh = !keyh; break;
							case "1": key1 = !key1; break;
							case "2": key2 = !key2; break;
							case "3": key3 = !key3; break;
							case "0": key0 = !key0; break;
						}

						link.style("display", function (d) {
							var flag = vis_by_type(d.source.type) && vis_by_type(d.target.type) && vis_by_node_score(d.source.score) && vis_by_node_score(d.target.score) && vis_by_link_score(d.score);
							linkedByIndex[d.source.index + "," + d.target.index] = flag;
							return flag ? "inline" : "none";
						});
						node.style("display", function (d) {
							return (key0 || hasConnections(d)) && vis_by_type(d.type) && vis_by_node_score(d.score) ? "inline" : "none";
						});
						text.style("display", function (d) {
							return (key0 || hasConnections(d)) && vis_by_type(d.type) && vis_by_node_score(d.score) ? "inline" : "none";
						});

						if (highlight_node !== null) {
							if ((key0 || hasConnections(highlight_node)) && vis_by_type(highlight_node.type) && vis_by_node_score(highlight_node.score)) {
								if (focus_node !== null) set_focus(focus_node);
								set_highlight(highlight_node);
							}
							else { exit_highlight(); }
						}

					}
				}

			});
			// $("html, body").animate({ scrollTop: $(document).height() }, "slow");
			function vis_by_type(type) {
				switch (type) {
					case "circle": return keyc;
					case "square": return keys;
					case "triangle-up": return keyt;
					case "diamond": return keyr;
					case "cross": return keyx;
					case "triangle-down": return keyd;
					default: return true;
				}
			}
			function vis_by_node_score(score) {
				if (isNumber(score)) {
					if (score >= 0.666) return keyh;
					else if (score >= 0.333) return keym;
					else if (score >= 0) return keyl;
				}
				return true;
			}

			function vis_by_link_score(score) {
				if (isNumber(score)) {
					if (score >= 0.666) return key3;
					else if (score >= 0.333) return key2;
					else if (score >= 0) return key1;
				}
				return true;
			}

			function isNumber(n) {
				return !isNaN(parseFloat(n)) && isFinite(n);
			}

		}
	</script>

</body>

</html>
